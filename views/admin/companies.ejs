<h2 class="mb-1">
    <i class="fas fa-building me-2"></i> Manage Companies
</h2>
<p class="text-muted mb-4">Add and manage pharmaceutical companies</p>

<!-- Flash Messages -->
<% if (success_msg && success_msg.length > 0) { %>
    <div class="alert alert-success alert-dismissible fade show">
        <%= success_msg %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
<% } %>

<% if (error_msg && error_msg.length > 0) { %>
    <div class="alert alert-danger alert-dismissible fade show">
        <%= error_msg %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
<% } %>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div></div>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCompanyModal">
        <i class="fas fa-plus me-2"></i> Add Company
    </button>
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped align-middle">
                <thead>
                    <tr>
                        <th>Company Name</th>
                        <th>Contact Person</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Medicines</th>
                        <th width="120">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (companies && companies.length > 0) { %>
                        <% companies.forEach(company => { %>
                            <tr>
                                <td><strong><%= company.company_name %></strong></td>
                                <td><%= company.contact_person || 'N/A' %></td>
                                <td><%= company.company_email || 'N/A' %></td>
                                <td><%= company.company_phone || 'N/A' %></td>
                                <td>
                                    <span class="badge bg-info">
                                        <%= company.medicine_count %> medicines
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary"
                                        onclick="editCompany(
                                            <%= company.id %>,
                                            '<%= company.company_name %>',
                                            '<%= company.contact_person || '' %>',
                                            '<%= company.company_email || '' %>',
                                            '<%= company.company_phone || '' %>',
                                            '<%= company.company_address || '' %>'
                                        )">
                                        <i class="fas fa-edit"></i>
                                    </button>

                                    <form method="POST"
                                          action="/admin/companies/<%= company.id %>/delete"
                                          class="d-inline"
                                          onsubmit="return confirm('Delete this company?')">
                                        <button class="btn btn-sm btn-outline-danger">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr>
                            <td colspan="6" class="text-center text-muted">
                                No companies found
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- ADD COMPANY MODAL -->
<div class="modal fade" id="addCompanyModal" tabindex="-1">
    <div class="modal-dialog">
        <form method="POST" action="/admin/companies" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Company</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Company Name *</label>
                    <input class="form-control" name="company_name" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Contact Person</label>
                    <input class="form-control" name="contact_person">
                </div>
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" name="company_email">
                </div>
                <div class="mb-3">
                    <label class="form-label">Phone</label>
                    <input class="form-control" name="company_phone">
                </div>
                <div class="mb-3">
                    <label class="form-label">Address</label>
                    <textarea class="form-control" name="company_address"></textarea>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- EDIT COMPANY MODAL -->
<div class="modal fade" id="editCompanyModal" tabindex="-1">
    <div class="modal-dialog">
        <form method="POST" id="editCompanyForm" class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Company</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Company Name *</label>
                    <input id="edit_company_name" class="form-control" name="company_name" required>
                </div>
                <div class="mb-3">
                    <label class="form-label">Contact Person</label>
                    <input id="edit_contact_person" class="form-control" name="contact_person">
                </div>
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input id="edit_company_email" class="form-control" name="company_email">
                </div>
                <div class="mb-3">
                    <label class="form-label">Phone</label>
                    <input id="edit_company_phone" class="form-control" name="company_phone">
                </div>
                <div class="mb-3">
                    <label class="form-label">Address</label>
                    <textarea id="edit_company_address" class="form-control" name="company_address"></textarea>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<script>
function editCompany(id, name, contact, email, phone, address) {
    document.getElementById('editCompanyForm').action = `/admin/companies/${id}/update`;
    edit_company_name.value = name;
    edit_contact_person.value = contact;
    edit_company_email.value = email;
    edit_company_phone.value = phone;
    edit_company_address.value = address;

    new bootstrap.Modal(editCompanyModal).show();
}
</script>
